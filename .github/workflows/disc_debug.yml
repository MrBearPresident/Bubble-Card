name: DBEUG_Notify Inactive Discussions in Specific Category

on:
  workflow_dispatch: # Allows manual trigger

jobs:
  notify-inactive-discussions:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Debug Find Inactive Discussions
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # Define the category slug
        CATEGORY_NAME="questions-about-config-custom-styles-and-templates"

        # Fetch and debug discussions
        gh api graphql -f query='
        query($owner: String!, $repo: String!) {
          repository(owner: $owner, name: $repo) {
            discussions(first: 100, orderBy: {field: UPDATED_AT, direction: ASC}) {
              nodes {
                id
                title
                url
                updatedAt
                category {
                  name
                }
                labels(first: 10) {
                  nodes {
                    name
                  }
                }
              }
            }
          }
        }' -f owner="MrBearPresident" -f repo="Bubble-Card" \
        jq -r '.data.repository.discussionCategory.discussions.nodes[] | 
              (.url, .updatedAt, (now - (.updatedAt | fromdateiso8601)))'
